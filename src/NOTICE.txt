NOTICE: no new features after 11 PM. Only bug fixes, unit tests and comments. 